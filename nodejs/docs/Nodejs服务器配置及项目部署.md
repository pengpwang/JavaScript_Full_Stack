
## Nodejs服务器配置及项目部署

### 第一章 课程预热

#### 1-1. 为什么是全栈最后一公里
1. 内容包括：
  - 域名解析
  - 项目的部署发布
  - 线上数据库的管理

2.
  - 眼界和努力；
  - 分享和社交；

#### 1-2. 搭建线上生产环境需要做什么

生产环境所需要素：
1. 购买域名
（1）ip地址也能访问到资源，但ip地址：
    - 格式不太友好，不太容易记住
    - 苹果商店，微信小程序不支持ip地址这种方式来访问，必须是域名
（2）在哪里买，如何购买
（3）如何购买及生成https的ssl证书
（4）域名的解析

2. 购买服务器
服务器：无论是独享的还是共享的，其实就是一台带外网ip的电脑

3. 域名备案
- 通过网络提供商的资源及平台对域名进行备案
- 国内必须备案，国外无需
- 短信服务，邮件服务，微信相关都需要备案才能使用

4. 配置服务器应用环境
- 用户的权限
- 无密码的登录
- Nodejs应用的环境
- 必备的包及组件的安装及搭建
- 端口的转发
- ssl证书的生成和配置
- Nginx的安装和配置
- 防火墙
- 本地数据库
- 自动备份的机制

5. 安装配置数据库
（1）使用服务器上的本地数据库，需要自己动手安装
  涉及到：
  - 数据库的角色
  - 读写的权限
  - 自动备份的机制
（2）采用第三方云数据库，无需做这步，但云数据库一般比较贵

6. 项目远程部署与发布
（1）手动上传 -- 不推荐
（2）使用付费或免费的但是私密的git仓库平台，把本地代码自动部署到线上，在线上进行服务的重启，自动化

### 第二章 待部署的5个本地Nodejs项目

#### 2-1 快速本地搭建一个纯静态简易站点
#### 2-2 Nodejs 电影网站项目上线准备
#### 2-3 狗狗说 React Native 开发的 App 后台项目分析
#### 2-4 微信小程序的项目介绍
#### 2-5 电影微信公众号的项目概况
#### 2-6 从一个故事理解整个部署思路
- 整体故事不错

### 第三章 选购域名服务器及备案

#### 3-1 选购域名的经验分享
（1）建议购买和持有自己的域名
   - 可以分出很多子域名，用来做博客，电商网站等
（2）选购：
   - 选择哪家的域名，即域名厂商：选择大厂商，知名厂商，比如：爱名网【www.22.cn】；阿里云； DNSpod; GoDaddy
   - 选择的方法和习惯：纯英文，纯数字，纯拼音，不要混合，纯英文最好，纯好的数字的都被抢光了，拼音的首字母或单词的首字母凑出来的，域名越短越好；域名后缀，.com, .cn, .cc ; 推荐阿里云；
   - 无论注册哪个域名，都在dnspod上做解析指向  [https://www.dnspod.cn/] 把域名指向到某一台服务器上去，从而来访问到提供的web服务
   - 购买域名的时候，可先不买ssl证书；可以免费配置ssl证书

#### 3-2 主机厂商对比及选购阿里云主机
（1）云主机：
  - 选择：什么配置，价位，哪家厂商
  - 选择大厂商，知名厂商 ==》防止倒闭；尽量选择国内的主机商；国外的涉及备案和国家审核 
  - 阿里云 ECS
 (2) 云主机厂商
  - 国外：亚马逊 AWS；Linode；DigitOcean/Heroku
  - 国内：阿里云 ECS；青云/UCloud/百度云
（3）阿里云 ECS 购买
  - 配置选择
  - root密码设置
  - 公网，内网Ip

#### 3-3 域名备案流程走起来

阿里云ECS通过阿里云平台备案
- 保证域名注册人和备案人一致

### 第四章 远程登录服务器

#### 4-1 第一次 ssh 远程登陆服务器
需要用户名和公网ip地址;
阿里云ECS默认用户名为root;
每个云服务商默认的用户名可能不一样;

`ssh root@公网ip`

注意：
1. 系统可重装，先停止再重装
2. 购买数据盘的话，需要额外挂载
3. 阿里云默认挂载了一个40G的硬盘，是用来安装操作系统的。如果将网站应用都跑在系统盘上，也可以，但一旦重装系统之后，所有的网站资料，比如用户信息，都会丢失。如果是在数据盘上，即使系统重装了，数据还在数据盘上，提高了数据安全性

查看硬盘信息：`fdisk -l`
查看硬盘使用情况：`df -h`

如何通过私钥认证的方式实现无密码登录？

#### 4-2 配置 root 及应用账号权限

root权限是服务器的最高权限;
添加一个用户：`adduser xxx`；设置密码;对此用户授权: `gpasswd -a xxx sudo` 让此用户以sudo的角色调用系统命令，但必须输入密码；
`sudo visudo`


#### 4-3 配置本地无密码 SSH 登录





