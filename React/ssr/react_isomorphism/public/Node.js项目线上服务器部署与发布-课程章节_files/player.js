define("class/chapter/player",["require","//moco.imooc.com/mocoplayer/3.0.4/mocoplayer.js"],function(){"use strict";function i(){s?(a=(new Date).getTime(),r=(a-s)/1e3):r=0,s=0,a=0,zhuge.track("TryCourse",{Platform:"web",Category:"实战",CID:window.GlobalConf.course,PlayTime:r})}var e=0,t=!0,n={userInfo:{uid:window.GlobalConf.user}},o=document,s=0,a=0,r=0,c=function(i,e){this.el=i||{},this.multiple=e||!1;var t=this.el.find(".js-change-media");t.on("click",{el:this.el,multiple:this.multiple},this.dropdown)};c.prototype.dropdown=function(i){var e=i.data.el,t=$(this),n=t.next();n.slideDown(),t.parent().addClass("open"),i.data.multiple||e.find(".try-video-container").not(n).slideUp().parent().removeClass("open")};var l=(function(){var i=[],e=[];$.ajax({url:"/class/api_freelook?cid="+window.GlobalConf.course,type:"get",dataType:"json",success:function(t){if(1==t.result){$(".video-list").html(""),$.each(t.data,function(t,n){var o=n.media_id,s=n.chapter_seqid+"-"+n.seqid+" "+n.name,a='<li>                                            <a href="javascript:void(0);" class="js-change-media ui-media-title" data-mid="'+o+'" data-title="'+s+'">                                                <i class="imv2-video_circle"></i>                                                <div class="right-box">                                                     <div class="title">'+s+'</div>                                                    <div class="state"></div>                                                </div>                                            </a>                                            <div id="try-video-container'+t+'" class="try-video-container"></div>                                        </li>';i.push(o),e.push(s),$(".video-list").append(a)});{new c($(".video-list"),!1)}d.freeList=i,d.titles=e,d.container.videoElem=$(".try-video-container")}}})}(),function(){return $(document).scrollTop()}),d={freeList:[],titles:[],current:null,container:{rootElem:$("#video-wrap"),videoElem:$(".try-video-container"),top:0,show:function(i){this.rootElem.show(),i||(this.top=l(),$("body").css({position:"fixed",width:"100%",top:-1*this.top+"px"}))},hide:function(){this.videoElem.empty(),this.videoElem.hide(),this.rootElem.hide(),$("body").css({position:"initial",height:"auto"}),$(document).scrollTop(this.top)}},init:function(i,o,a){var r=this;if(Array.isArray(i)){var c=i.join("").split("#")[0],l=i.join("").split("#")[1],u=["http://coding.imooc.com/lesson/m3u8h5?mid=",c,"&cid=",l,"&ssl=0","&cdn=aliyun1"].join("");/^https/.test(window.location.protocol)&&(u=["https://coding.imooc.com/lesson/m3u8h5?mid=",c,"&cid=",l,"&ssl=1","&cdn=aliyun1"].join(""));var h=this.freeList.indexOf(c);this.current=h>-1?h:null;var p=$(".video-list li:eq("+h+")");p.addClass("active").siblings().removeClass("active").find(".state").text(""),p.find(".state").text("正在播放"),$(a).show(),this.container.show(o),window.thePlayer=mocoplayer($(a),{url:u,title:r.titles[h],showAd:t,currentTime:e,uid:n.userInfo.uid,phone:n.userInfo.uid,events:{onReady:function(){if(s=(new Date).getTime(),"html5"==this.getPlayType()){var i=this,n=2e3;e||!t?n=0:$(a).append('<div id="js-video-copyright" style="width:100%;height:100%;position:absolute;z-index:599;left:0;top:0;                                background:#000 url(/static/module/common/img/copyright.png) no-repeat center center;background-size:100% auto"></div>'),setTimeout(function(){$("#js-video-copyright").remove(),i.play()},n)}else i.play()},onComplete:function(){var i=d.freeList[d.current+1],e=d.titles[d.current+1],t=['<p class="next-hd">下一节：<span class="next-name">'+e+"</span></p>"];e||(t=['<p class="next-hd">试看章节已结束，如果您喜欢本课程，请移步购买。</p>']),t.push(i?'<div class="next-btns"><a href="javascript:;" data-mid="'+i+'" class="next-btn js-next-media">下一节</a></div>':'<div class="next-btns"><a href="javascript:;" data-cid=" '+window.GlobalConf.course+'" data-pay= "0" class="next-btn js-mediabuy-trigger">立即购买</a></div>'),$("#next-media-content").html(t.join("")),$("#next-mask").css("top",218+54*h+"px"),$("#next-mask").addClass("in")},onPlay:function(){},onPause:function(){},onError:function(){}}})}},destroy:function(){this.current=null,window.thePlayer.destroy(),window.thePlayer=null,$("#next-mask").removeClass("in"),this.container.hide()},replay:function(){if($("#next-mask").removeClass("in"),"html5"==window.thePlayer.getPlayType()){var i=2e3;e||!t?i=0:$(videoDom).append('<div id="js-video-copyright" style="width:100%;height:100%;position:absolute;z-index:599;left:0;top:0;                            background:#000 url(/static/module/common/img/copyright.png) no-repeat center center;background-size:100% auto"></div>'),setTimeout(function(){$("#js-video-copyright").remove(),window.thePlayer.play()},i)}else window.thePlayer.play()},nextview:function(i,e){window.thePlayer.destroy(),window.thePlayer=null,$("#next-mask").removeClass("in"),this.init(i,!0,e)}};$(".js-watchForFree").on("click",function(){var i=$(this),e=(i.next().val()+"#"+GlobalConf.course).split(""),t=$(this).attr("data-index"),n=$(".try-video-container")[t];d.init(e,!1,n)}),$(".js-watchTrigger").on("click",function(){$(this).parent().find(".js-watchForFree").trigger("click")}),$("#js-close-mediaview").on("click",function(){i(),d.destroy()}),$(".js-view-again").on("click",function(){$("#next-mask").removeClass("in");var i=$(".video-list li.active").find(".js-change-media");i.click()}),$("#next-media-content").on("click",".js-next-media",function(){var i=$(".video-list li.active").next().find(".js-change-media");i.click()}),$("#next-media-content").on("click",".js-mediabuy-trigger",function(){$("#buy-trigger").trigger("click")}),$(o).on("click",".js-change-media",function(){i();var e=$(this).attr("data-mid"),t=(e+"#"+GlobalConf.course).split(""),n=$(this).siblings(".try-video-container");d.nextview(t,n)}),$(".js-enter-tryMedia").on("click",function(){var i=(d.freeList[0]+"#"+GlobalConf.course).split(""),e=$(".try-video-container")[0];d.init(i,!1,e)})});